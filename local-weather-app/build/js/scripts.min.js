"use strict";$(document).ready(function(){function t(t){var e=$(".metric-btn"),a=$(".imperial-btn"),i=$(".temp-box__value"),n=$(".wind__speed"),r=0,c=0;t.hasClass("metric-btn")&&!t.hasClass("metric-btn--active")?(c=n.html().match(/\d+/g),c=Math.round(c/2.237),n.html(c+" m/s"),r=i.html().split(",").shift(),r=Math.round((r-32)/1.8),i.html(r+", °C"),e.addClass("metric-btn--active"),a.removeClass("imperial-btn--active")):t.hasClass("imperial-btn")&&!t.hasClass("imperial-btn--active")&&(c=n.html().match(/\d+/g),c=Math.round(c/.44704),n.html(c+" mph"),r=i.html().split(",").shift(),r=Math.round(1.8*r+32),i.html(r+", °F"),a.addClass("imperial-btn--active"),e.removeClass("metric-btn--active"))}function e(t){var e=n(t.countryCode),r={},c="http://api.openweathermap.org/data/2.5/weather?q="+t.city+","+t.countryCode+"&units="+e+"&appid=e2db5b0453a25a492e87ad8b03046a7c";"metric"===e?(r.tempUnits="°C",r.windUnits="m/s"):(r.tempUnits="°F",r.windUnits="mph"),$.getJSON(c,function(e){i({country:t.country,city:t.city,weather:e.weather[0].main,weatherDetails:e.weather[0].description,windSpeed:e.wind.speed,windUnits:r.windUnits,windDirection:a(e.wind.deg),temp:e.main.temp,tempUnits:r.tempUnits,icon:e.weather[0].icon})})}function a(t){var e="";switch(!0){case t>0&&t<90:e="NE";break;case 90===t:e="E";break;case t>90&&t<180:e="SE";break;case 180===t:e="S";break;case t>180&&t<270:e="SW";break;case 270===t:e="W";break;case t>270&&t<360:e="NW";break;case 0===t||360===t:e="N";break;default:e="no wind direction data"}return e}function i(t){var e=$(".wrapper"),a=$(".temp-box__value"),i=$(".temp-box__icon"),n=$(".location"),r=$(".weather"),c=$(".wind").children(),s="http://openweathermap.org/img/w/"+t.icon+".png",p=$(".metric-btn"),o=$(".imperial-btn"),l={Thunderstorm:"http://more-sky.com/data/out/10/IMG_405464.jpg",Drizzle:"http://img03.deviantart.net/de1c/i/2009/304/3/9/pluo_by_aik_art.jpg",Rain:"http://webneel.com/wallpaper/sites/default/files/images/04-2013/creative-rain_0.jpg",Snow:"http://wallpapercave.com/wp/j2pzwKj.jpg",Clear:"http://www.traemcneely.com/wp-content/uploads/2015/02/wpid-wp-1424111867667.jpeg",Clouds:"http://wallpaper-gallery.net/images/cloud-wallpaper/cloud-wallpaper-22.jpg"};for(var m in l)m===t.weather?e.css({"background-image":"url("+l[t.weather]+")"}):e.css({"background-color":"#E8F1F2"});"°C"===t.tempUnits?p.addClass("metric-btn--active"):o.addClass("imperial-btn--active"),i.css({"background-image":"url("+s+")"}),a.html(t.temp+", "+t.tempUnits),n.html(t.city+", "+t.country),r.html(t.weather+", "+t.weatherDetails),$(c[0]).html(t.windDirection+",&nbsp;"),$(c[1]).html(t.windSpeed+" "+t.windUnits)}function n(t){return-1===["US","BS","BZ","KY","PW"].indexOf(t)?"metric":"imperial"}$.getJSON("http://ip-api.com/json/?callback=?").then(function(t){e({city:t.city,country:t.country,countryCode:t.countryCode})}),$(".units-toggle").on("click",function(e){t($(e.target))})});